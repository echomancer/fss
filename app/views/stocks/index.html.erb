<h1 id="access">Listing Current Pantry</h1>
<% if @stocks.count == 0 %>
  <div class="row text-center">
    <h4>Your pantry is currently empty.</h4>
  </div>
<% else %>
  <%= will_paginate %>
  <div class="row">
    <div class="col-md-3 col-xs-3">Food Name</div>
    <div class="col-md-3 col-xs-3">Total Servings Left</div>
    <div class="col-md-3 col-xs-3">Total Paid</div>
    <div class="col-md-3 col-xs-3">Total Discount</div>
  </div>
  <div class="row">
    <div class="panel-group" id="#accordian">
      <% current_food, last_food = nil, nil %>
      <% @stocks.each do |stock| %>
        <% current_food = stock.food.id %>
        <% if current_food != last_food %>
          <% current_total = @totals.find_by(food_id: stock.food.id) %>
          <% if last_food != nil %>
            </tbody></table></div></div></div></div>
          <% end %><!-- end of table and closing divs -->
          <div class="panel panel-info">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordian-toggle" data-toggle="collapse" data-parent="#accordian" href=<%= "#food_data_#{current_food}"%>>
                  <div class="row">
                    <div class="col-md-3 col-xs-3"><%= stock.food.name %></div>
                    <div class="col-md-3 col-xs-3"><%= current_total.quantity %></div>
                    <div class="col-md-3 col-xs-3"><%= number_to_currency(current_total.price-current_total.discount, precision: 2) %></div>
                    <div class="col-md-3 col-xs-3"><%= number_to_currency(current_total.discount, precision: 2) %></div>
                  </div>
                </a>
              </h4>
            </div>
            <% id = "food_data_#{current_food}" %>
            <div id="<%=id%>" class="panel-collapse collapse">
              <div class="panel-body">
                <div class="container">
                  <table class="table table-condensed">
                    <thead>
                      <th>Servings Left</th>
                      <th>Price per Unit</th>
                      <th>Discount per Unit</th>
                      <th>Store</th>
                      <th>Date Bought</th>
                    </thead>
                    <tbody>
        <% end %><!-- end of panel info -->
                      <tr data-href=<%= edit_stock_path(stock) %>>
                        <td><%= stock.quantity %></td>
                        <td><%= number_to_currency(stock.price-stock.discount, precision: 2) %></td>
                        <td><%= number_to_currency(stock.discount, precision: 2) %></td>
                        <td><%= stock.store.name %></td>
                        <td><%= stock.bought %></td>
                      </tr>
                      <% last_food = current_food %>
      <% end %><!-- end of loop -->
                    </tbody>
                  </table>
                </div><!-- end of container -->
              </div><!-- end of panel-body -->
            </div><!-- end of panel-collapse -->
          </div><!-- end of panel -->
    </div><!-- end of panel-group -->
  </div><!-- end of row -->
  <%= will_paginate %>
<% end %><!-- end of display for visible pantry items -->
</br>
<div class="row">
  <% if can? :create, @stocks %><%= link_to "Add Food to Pantry", new_stock_path, {:class => 'btn btn-primary'} %><% end %>
</div>